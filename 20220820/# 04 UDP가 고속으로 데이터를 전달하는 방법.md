# 04 UDP가 고속으로 데이터를 전달하는 방법
: VoIP나 동영상 스트리밍과 같이 데이터 전송의 신뢰성보다는 속도가 우선일 때는 UDP를 사용한다.

* UDP
  : UDP(User Dataprogram Protocol)는 TCP에 비해 상당히 간단한 프로토콜로서 단순히 데이터를 보내는 역할
  : 통신과정에서 데이터의 손실이 발생할 수 있는데, VoIP와 같은 음성 서비스나 동영상 스트리민 서비스는 일부 데이터가 누락되거나 왜곡되더라도 큰 문제가 없기 때문에 UDP를 주로 사용한다.

* TCP에는 없는 기능으로 UDP에는 하나의 패킷을 여러 수신지에 전달하는 브로드캐스트(broadcast)와 멀티캐스트(multicast)라는 기능이 있다. 브로드캐스트는 파일공유나 DHCP와 같이 네트워크 내의 여러 컴퓨터나 통신 장비와 정보를 교환할 때 사용된다.

* UDP를 애플리케이션 계층으로 둘러싼다.
  : 실시간 처리가 필요한 온라인 게임에서는 전송 속도가 우선인 UDP를 사용하긴 하지만, 데이터 전송의 신뢰성 역시 속도에 못지않게 중요하다. 이런 경우에는 애플리케이션 계층에서 흐름 제어(flow control)나 혼잡제어(congestion control)를 구현해서 부족한 신뢰성을 보완하게 된다.
  : TCP처럼 데이터의 전송의 신뢰성을 높이면서도 효율적인 처리로 속도 저하가 크지않게 만들어 준다.


# 05 netstat 명령으로 네트워크의 상태 확인하기 
: netstat는 컴퓨터의 접속 상태를 목록으로 확인할 수 있는 명령이다. 

* netstat 명령을 실행한다
  : TCP나 UDP는 웹 브라우저와 같은 애플리케이션 뒤에서 백그라운드(background)로 동작하기 때문에 사용자가 직접 육안으로 확인 가능한 결과를 출력하지는 않는다. 다만, netstat 명력으로 접속 상태를 확인하는 것은 가능한데, IP 어드레스나 프로토콜, 포트 번호 등의 목록을 조회할 수 있다.

  1. 명령 프롬포트 실행
  2. 'netstat -n'을 입력한 후에 'Enter'키를 누른다.
  3. 활성 상태의 TCP 접속 상태가 표시된다.


< 4장 라우팅과 인터넷 계층 >

# 01 인터넷 계층의 역할
: 인터넷 계층의 프로토콜은 수신지 컴퓨터가 아무리 멀리 있더라도 데이터를 전달 할 수 있도록 설계되어 있다.

* IP 어드레스 정보를 보고 데이터를 전달한다
  
  - 인터넷 계층 : 네튿워크 인터페이스 계층과 협력하여 다른 컴퓨터에게 데이터를 전달하는 역할
             : IP 어드레스 라고 하는 식별자 정보를 실마리로 데이터를 전달할 수 있는 체계를 제공하는 역할
  - 네트워크 인터페이스 계층 : 하드웨어에 의존해야하는 부분을 담당
  
  - 송신지, 수신지의 컴퓨터는 IP 어드레스로 식별할 수 있다.
  - IP 어드레스 정보를 보고 인터넷 어딘가에 연결된 컴퓨터를 찾아 데이터를 전달한다.
  - 라우터가 데이터를 전달한다. 

* 라우터와 라우팅
  - 라우터(router) : 데이터를 목적지까지 전달하기위한 네트워크 장비
                  : 네트워크와 네크워크를 연결하는 역할 / 하나의 라우터는 데이터를 목적지까지 전달하기 위해 다음 네트워크의 경로를 찾고, 그 경로상에 있는 라우터에게 데이터 전달을 위임하게 됨
  - 라우팅(routing) : 위의 과정은 최종 목적지를 찾기까지 연쇄적으로 반복되는데, 이렇게 라우터가 목적지의 경로를 찾아 나가는 과정을 라우팅이라고 함.

* IP 어드레스의 고갈을 방지하기 위한 대안 : 인터넷 보급이 급속도로 확산함에 따라 IP 어드레스 감소

   - 프라이빗 어드레스 : 사설 IP라고 불리며, 사무실이나 가정 내에서만 사용 가능한 IP 어드레스. 소속 네트워크 내부에서만 사용되므로 외부에서는 해당 IP 어드레스로 접근이 불가능하여 클라이언트 역할을 하는 컴퓨터가 주로 사용한다.
   - 퍼블릭 어드레스 : 공개 IP 등을 불리며, 인터넷에서 사용 가능한 IP 어드레스를 말함. 외부에서도 접근이 가능하고 서버 역할을 하는 컴퓨터가 주로 사용한다.

# 02 IPv4와 IPv6
: IPv4와 IPv6는 인터넷 계층에서 사용되는 중요한 프로토콜로, IP 어드레스를 결정 할 때 사용하는 비트의 길이가 서로 다르다.

- IPv4 (Internet Protocol Version 4) : 현재까지 컴퓨터의 어드레스를 지정할 때 가장 많이 사용되는 인터넷 계층의 프로토콜
                                     : 네트워크에 연결된 컴퓨터를 식별하기 위해 32비트의 IP 어드레스가 사용됨.

                                     : 헤더에 분할처리를 위한 다양한 필드들이 준비되어 있음
- IPv6 : 최근 128비트 어드레스로 만든 IPv6의 보급이 가속화 됨
       : IPv6는 애당초 라우터에서 데이터를 분할하지 않는 방식으로 사양이 만들어져 있어서 분할관련 필드는 옵션으로 되어있다.


# 03 IP 어드레스의 활용
: IP 어드레스는 주소 할당 방법에 따라 네트워크 부와 호스트 부로 나뉘어지고, 해당 주소에 대한 접근 범위에 따라 프라이빗 어드레스와 퍼블릭 어드레스로 구분된다.

* IP 어드레스는 네트워크를 표현하는 부분과 그 네트워크에 속한 호스트를 표현하는 부분으로 구성된다.
    - 호스트 : 네트워크에 연결된 컴퓨터나 네트워크 장비를 의미

* 어드레스 클래스
  : 하나의 IP를 어드레스 안에서 어디까지가 네트워크 부이고 어디까지가 호스트 부인지 미리 그 길이를 고정하여 결정해 둔 것
  : 어드레스 클래스 방식에서는 네트워크 부는 고정크기다.

  * 클래스 A의 어드레서는 한개의 네트워크당 약 1677만 대의 호스트의 어드레스를 할당할 수 있지만 실제로는 그렇게 많은 호스트를 하나의 네트워크에 연결하는 경우는 거의 없기때문에 많은 수의 어드레스가 사용되지 않고 낭비된다. 네트워크 부의 길이가 미리 정해져 있다.
       : 어드레스 클래스를 사용한 네트워크를 좀더 세분화하는 방법 : 서브넷 마스크 - 서브넷 마스를 사용하면 정해진 길이를 비트 단위로 유연하게 늘려서 쓰는 것이 가능
  * 서브넷 마스크의 한계 : 서브넷 마스크는 어드레스 클래스에서 미리 정해진 네트워크 부의 길이를 더 늘일 수는 있지 만 더 줄이지느 못한다. 그래서 서브넷을 도입하는 경우는 호스트 부가 긴 클래스 A나 B의 어드레스를 세분화해야 할 때 사용하는 것이 일반적이다.

* 프라이빗 어드레스 : 가정이나 사내에서 자유롭게 사용할 수 있는 어드레스
                : 인터넷에 연결해도 외부에서 접근할 수 없기 때문에 NAT(Network Address Translation)와 같은 어드레스 변환 기술을 사용해서 퍼블릭 IP 어드레스로 변환해주는 기법이 필요함

* 퍼블릭 IP 어드레스가 중복되어 있다면 데이터를 어디로 보내야 할지 알 수 없기 때문에 큰 혼란을 줄 수 있다.

* 인터넷 레지스트리
  - 퍼블릭 IP는 안터넷 레지스트리를 통해 인터넷 서비스 제공자들에게 할당되고 기업이나 가정은 인터넷 서비스 제공자가 확보한 IP 어드레스들을 빌려서 쓴다.

# 04 라우팅이란 
: 데이터를 목적지의 IP 어드레스까지 전달하려면 라우팅이라고 하는 경로 탐색 과정이 필요하다.

- 라우팅 : 인터넷에서 데이터가 목적지까지 제대로 전달되기 위해서는 라우터가 자신과 연결된 다른 라우터를 찾아나가면서 최종 목적지까지 연결되는 경로를 찾는 과정

* 라우팅 프로토콜 : 라우터끼리 누구랑 연결되어 있는지 정보를 교환한 후 경로 정보를 만들어 낸다.

* 자율시스템
  : 인터넷 서비스 제공자가 사용하는 규모가 큰 네트워크에서 몇 개의 네트워크를 하나로 묶어 자율시스템이라는 단위로 관리
  : 네트워크의 경로 하나하나를 찾아 다니며 이동하는 대신, AS와 같이 큰 덩어리의 접속 경로 단위로 이동하면 멀리 있는 커뮤터와도 더 빠른 속도로 통신할 수 있다.

# 05 라우터와 라우팅 프로토콜

* 라우터의 역할 : 네트워크 간의 패킷을 전달. 이때 연결하고 있는 각 네트워크에서 사용하는 IP 어드레스가 각각 하나씩 필요하며, 결과적으로 연결한 네트워크 개수만큼의 IP 어드레스를 여러 개 가지게 된다.
             : 목적지로 가기위한 경로는 라우팅 테이블을 보고 판단한다.
             : 연결된 네트워크별로 각각 서로다른 IP 어드레스를 가지고 있다.
             : 목적지 IP 어드레스를 보고 네트워크별로 패킷을 분류한 후 전달한다.
* 라우팅 테이블 : 목적지 호스트가 속한 네트워크 정보와 그 네트워크로 도달하기 위해 경유해야 하는 라우터의 정보가 들어있다.
             : 라우터는 내부에 저장하고 있는 라우팅 테이블이라는 정보를 활용하여 라우팅을 함
             : 고속도로의 도로 안내 표지처럼 목적지에 도착하기 위해서 어느 방향으로 가야하는지 알려주는 역할

* 정적 라우팅 : 네트워크 관리자가 직접 수작업으로 라우팅 테이블을 설정하는 방식
* 동적 라우팅 : 라우팅 프로토콜을 사용하여 자동적으로 경로 정보를 수집한 후 라우팅 테이블을 설정하는 방식

   => 네트워크 간의 접속 형태가 복잡하면 정적 라우팅으로 설정하는 것이 사실상 불가능하기 때문에 대부분은 동적 라우팅을 사용한다.

* 한 라우터의 라우팅 테이블에 목적지의 정복 ㅏ없다면 해당 라우터보다 더 ㅁ낳은 정보를 가지고 있는 기본 라우터 혹은 디폴트(default)라우터에게 물어보게 된다. 이 디폴트 라우터 정보는 각 라우터마다 정적으로 설정되어 있다.

* 동적 라우팅 알고리즘
  -  거리 벡터형 : RIP(Routing Informaiton Protocol) 프로토콜이 사용하는 방식
              : 목적지까지의 거리를 살펴보고 짧은 경로를 선택하는 방식
  - 링크 상태형 : OSPF(Open Shortest Path First) 프로토콜이 사용하는 방식
             : 네트워크의 통신 상태 정보를 맵(map)으로 관리하면서 상태가 가장 좋은 경로를 선택하는 방식
             : 복잡하고 변화가 잦은 네트워크 구성에 적합
  - 경로 벡터형 : 이들 위에 자율 시스템 AS간의 통신에서 사용됨

* AS(자율시스템) 안에서는 주로 링크 상태형인 OSPF를 사용한다. 다만, 링크 상태형은 네트워크 규모가 커지면 맵 정보를 처리하는 부하가 커질 수 있다. 따라서 네트워크를 몇 개의 영역으로 분할한 후 각 영역별로 맵을 따로 만드는 방식을 사용한다.
       : 접속 확인을 하고 경로 정보를 서로 교환하면서 모든 라우터가 같은 맵 정보를 가지도록 한다.


* AS 끼리는 경로 벡터형인 BGP(Border Gateway Protocol)가 사용됨. 경로 벡터형은 경로의 거리뿐만 아니라 경로 도중에 경유하는 AS 정보도 포함하여 경로 정보를 만든다.
    - 경로 정보에 AS 정보를  추가하여 전달하다 보면 최종적으로는 모든 라우터의 경로를 파악할 수 있게 된다.

# 06 네트워크 오류를 통보하는 ICMP
: 데이터 전송 중에 오류가 발생하면 ICMP 프로토콜로 통보한다.

* ICMP의 동작방식
  - ICMP(Internet Control Message Protocol)프로토콜은 데이터 전송 중에 문제가 생길경우 장애 상황을 통보하기 위해 사용된다.
       : ICMP패킷은 IP 헤더에 타입이나 코드와 같은 ICMP 메시지를 덧붙인 형태이다.

  - 라우터 요청 메시지 : 장비가 네트워크에 연결될 때 라우터를 찾기 위해 보내는 메시지(RS, Router Solicitation)
  - 라우터 광고 메시지 : 라우터 정보 요청에 대한 응답으로 라우터 정보를 모내는 메시지(RA, Router Advertisement)

# 07 어드레스 변환
: 프라이빗 IP 어드레스를 할당받은 호스트와 퍼블릭 IP 어드레스를 할당받은 호스트는 기본적으로 서로 통신을 하지 못한다. 하지만 어드레스 변환 기술을 사용하면 둘 간의 통신이 가능해진다.


* 네트워크 어드레스 변환(NAT)의 동작 방식
  : 가정이나 사무실의 네트워크에서는 보통 프라이빗 IP 어드레스를 사용한다. 이 주소는 내부에서 사용하는 가상의 주소라서 인터넷에 연결된 퍼블릭 IP 어르레스를 사용하는 서버와의 통신은 불가능하다.
    이때, 네트워크 어드레스 변환(NAT, Network Address Translation)기술이 사용됨

    - 라우터 : IP 어드레스를 변환했다는 것을 기억해둔다
    - 송신할 때는 송신지의 프라이빗 IP 어드레스를 라우터의 퍼블릭 IP 어드레스로 바꿔서 데이터를 보낸다
    - 수신할 때는 라우터의 퍼블릭 IP 어드레스를 송신지의 프라이빗 IP 어드레스로 다시 바꿔 보낸다.

* NAT 에서 발생할 수 있는 제약사항
  - NAT은 단순히 IP어드레스를 변환할 뿐  몇 가지 상황에서 제약이 발생할 수 있다.

    1. 내부의 여러 호스트가 공교롭게 같은 포트 번호를 사용하고 있다면 라우터는 이 요청에 대한 응답을 어느 호스트에게 되돌려 보내야 하는지 포트만 보고 판단하지 못한다.
    2. 내부에서 보낸 요청에 대한 응답은 받을 수 있지만 외부에서 일방적으로 보낸 데이터는 NAT 범위 안에 있는 호스트로 전달되지 않는다.

* 네트워크 어드레스 포트 변환(NAPT, Network Address Port Translation)
  : NAT의 포트 번호 충돌을 막기 위해 만들어진 방식
  : IP 어드레스뿐만 아니라 포트번호도 함께 변환한다. 내부 네트워크에서 프라이빗 IP를 사용하는 여러 호스트가 같은 포트 번호를 사용하고 있다면, 외부와 통신할 때 포트 번호가 충돌나지 않도록 변환해서 요청을 보낸 호스트를 구분할 수 있도록 한다.
   
     - 송신할 때 : 포트 번호를 바꿔 넣는다
     - 수신할 때 : 송신할 때 정보를 참고하여 포트 번호를 다시 되돌려 놓는다.
     - 포트 번호를 보고 요청을 보낸 호스트를 식별할 수 있다.


* 외부에서 접속이 가능하게 하는 방법
    - 메시지의 자동 확인
         : 사용자가 직접 요청한 것은 아니지만 내부에서 외부로 자동으로 정보를 요청하고 응답을 받는 방식

    - 포트 포워딩(port forwarding) : LAN안에 웹 서버나 FTP 서버를 운영하면서 외부로 이 서비스를 공개해야 할때 라우터의 특정 포트번호로 통신이 들어오면 내부의 특정 서버에 전달되도록 설정할 수 있는 방법

# 08 도메인명
: IP 어드레스는 긴 숫자 형태로 표현되기 때문에 사람이 알아보기 어렵다. 그래서 상대적으로 사람이 다루기 쉬운 도메인명을 대신 사용할 수 있다.

* URL에서 호스트명을 제외한 부분이 도메인명이지만, 호스트명을 포함한 전체를 도메인명으로 부르기도한다.

* 도메인 명에 대응하는 IP어드레스 정보가 알고싶다면 DNS 서버에게 물어보면 된다. 다만 사전에 컴퓨터나 라우터에 DNS 서버의 IP어드레스가 등록되어 있어야한다.

* 도메인명은 계층 구조 형태를 마침표로 구분하여 표현한다. 가장 뒤에 나오는 'kr'이나 'com'과 같은 도메인이 상위 도메인에 해당하고, 최상위 도메인 혹은 탑 레벨 도메인이라고 부른다. 탑 레벨 도메인의 하위 도메인은 2단계 혹은 서브 도메인이라고 부른다.

* DNS 서버의 계층 구조
  : DNS 서버는 자신이 담당하는 영역에 대한 도메인명을 관리하게 되는데, 이렇게 도메인명 데이터를 직접 관리하는 DNS 서버를 DNS 콘텐츠 서버라고 부른다

* DNS 서버의 종류
  - 콘텐트 서버(content server) : 도메인명을 관리
  - 캐시 서버(cashing server) : 질의에 응답하기 위함 
                            : DNS 캐시 서버는 루트 네임 서버부터 순차적으로 질의하게 되고, 질의 결과로 IP 어드레스를 알게 되면 그 내용을 요청한 클라이언트에게 응답하게 된다. 한번 질의한 내용은 캐시로 보관되게 때문에 이후 같은 질의가 들어오면 콘텐트 서버까지 가지 않고 바로 IP어드레스를 알려줄 수 있다.
      => 각 DNS 서버는 IP 어드레스를 알고 있는 하위 DNS 서버의 정보를 알려주는데, 이 과정을 반복하다 보면 최종적으로 목적지 주소를 알고 있는 DNS로 도달하게 된다.

      * hosts 파일 : 인터넷 초창기에는 호스트 명과 IP 어드레스를 매핑하기 위해 텍스트 파일 형태인 hosts 파일을 사용해서 IP 어드레스 변환을 했었다. 오늘날의 OS에도 이 흔적은 남아있어서 DNS에 등록되기 전의 서버나 DNS에 들록할 수 없는 서버에 접근해야할 경우 hosts 파일방식을 사용하기도 한다.
             - 정식 운영 전이고 개발 중인 서비스를 테스트할 때나 새 버전을 출시하기 전에 내부 테스트를 해야할 때 이 방법이 많이 활용된다. 테스트할 클라이언트 개수가 많아 hosts파일을 배포하기 어렵거나 hosts파일 자체를 변경하기 어려운 경우는 사설 DNS를 구성하는 방법을 이용하기도 한다. 

# Chapter 04. 라우팅과 인터넷 계층

---

## 1. 인터넷 계층의 역할

: 인터넷 계층의 프로토콜은 수신지 컴퓨터가 아무리 멀리 있더라도 데이터를 전달할 수 있도록 설계되어있다.

- IP 어드레스 정보를 보고 데이터를 전달한다.
    - 네트워크 인터페이스 계층 : 하드웨어에 의존해야 하는 부분
    - 인터넷 계층 : 식별자 정보를 실마리로 데이터를 전달할 수 있는 체계를 제공하도록 역할
    
    ⇒ 인터넷 계층과 네트워크 인터페이스 계층과 협력하여 다른 컴퓨터에게 데이터를 전달한다.
    
- 라우터와 라우팅
    - 라우터 : 데이터를 목적지까지 전달하기위한 네트워크 장비
        - 역할 : 네트워크와 네트워크를 연결
            - 하나의 라우터는 데이터를 목적지까지 전달하기 위해 다음 네트워크의 경로를 찾고, 그 경로상에 있는 라우터에게 데이터 전달을 위임
            - 이런 과정은 최종 목적지를 찾기까지 연쇄적으로 반복됨
    - 라우팅 : 라우터가 목적지의 경로를 찾아 나가는 과정

- IP 어드레스와 관련된 여러 기술
    - private address : 사설 IP라고 불리며, 사무실이나 가정 내에만 사용 가능한 IP 어드레스
        - 소속 네트워크 내부에서만 사용되므로 외부에서는 해당 IP 어드레스로 접근이 불가능하여 클라이언트 역할을 하는 컴퓨터가 주로 사용한다.
    - public address : 공개 IP 등으로 불리며, 인터넷 사용 가능한 IP 어드레스
        - 외부에서도 접근이 가능하여 서버 역할을 하는 컴퓨터가 주로 사용한다.

## 2.  IPv4 와 IPv6

: IPv4 와 IPv6는 인터넷 계층에서 사용되는 중요한 프로토콜로, IP 어드레스를 결정할 때 사용하는 비트의 길이가 서로 다르다.

- IPv4는 32비트 어드레스
    - 현재까지 컴퓨터의 어드레스를 지정할 때 가장 많이 사용되는 인터넷 계층의 프로토콜
- IPv4헤더
    - IPv4 패킷의 IP헤더에는 송신지와 수신지의 IP 어드레스 외에도 패킷 길이와 같은 다양한 정보들이 포함되어 있다.
    

    

- IP 패킷에도 유통기한이 있다.
    - IPv4  헤더에는 생존 기간 (TTL, Time To Live) 정보를 설정할 수 있게 되어있고, 만약 생존기간을 초과한 패킷이 네트워크 상에서 발견되면 그 패킷을 소멸시키도록 규정하고 있다.

- 좁은 길을 지날 때는 작게 분할해서 지나간다.
    - 한 번에 전송할 수 있는 데이터 크기를 MTU(Maximum Transmission Unit) 라고 하고, 이 값은 통신 경로의 상태에 따라 달라진다.

- IPv6
    - IPv4의 32 비트 어드레스가 머지않아 고갈될 상황에 이르렀다. 그래서 최근 128 비트 어드레스로 만든 IPv6의 보급이 가속화 되고 있다.

## 3. IP 어드레스의 활용

: IP어드레스는 주소 할당 방법에 따라 네트워크 부와 호스트 부로 나뉘어지고, 해당 주소에 대한 접근 범위에 따라 프라이빗 어드레스와 퍼블릭 어드레스로 구분된다.

- 네트워크 부와 호스트 부
    - IP 어드레스는 네트워크를 표현하는 부분과 그 네트워크에 속한 호스트를 표현하는 부분으로 구성된다.
    - 192.168.1.100
        - 네트워크 부
        - 호스트 부

- 어드레스 클래스
    - 하나의 IP 어드레스 안에서 어디까지가 네트워크 부이고 어디까지가 호스트 부인지 미리 그 길이를 고정하여 결정해 둔 것이 있는데, 이것을 어드레스 클래스(address class)라고 부른다.

- 어드레스 클래스의 제약
    - 클래스 A의 어드레스는 한 개의 네트워크당 약 1677만 대의 호스트의 어드레스를 할당할 수 있지만 실제로는 그렇게 많은 호스트를 하나의 네트워크에 연결하는 경우는 거의 없다.
    - 어드레스 클래스를 사용한 네트워크를 좀더 세분화할 수 있는데 이때 사용하는 것이 **서브넷 마스크**이다.

- 서브넷 마스크
    - 어드레스 클래스는 네트워크 부의 길이가 미리 정해져 있다. 하지만 서브넷 마스크를 사용하면 이 길이를 비트 단위로 유연하게 늘려서 쓰는 것이 가능하다.
    - 서브넷 마스크는 IP 어드레스에 추가되는 정보이므로 32비트 길이만큼의 정보가 더 필요하다.

## 4. 라우팅이란

: 데이터를 목적지의 IP 어드레스까지 전달하려면 라우팅이라고 하는 경로탐색 과정이 필요하다.

- 라우팅과 경로 검색
    - 라우팅 : 인터넷에서 데이터가 목적지까지 제대로 전달되기 위해서는 라우터가 자신과 연결된 다른 라우터를 찾아나가면서 최종 목적지까지 연결되는 경로를 찾는 것

- 라우팅 프로토콜
    - 데이터가 전송될 경로를 찾기 위해서 네트워크상의 각 라우터는 서로 누구와 연결되어 있는지에 대한 정보를 교환한다.
    - 이때 라우팅 프로토콜이 사용되는데 대표적인 것으로는 BGP, OSPF, RIP 등이 있다.
    - 라우팅 프로토콜
        
        [라우팅 프로토콜 RIP, BGP, OSFP](https://velog.io/@yh_lee/라우팅-프로토콜-RIP-BGP-OSFP)
        

## 5. 라우터와 라우팅 프로토콜

- 라우터의 역할
    - 네트워크 간의 패킷을 전달하는 것

- 라우팅 테이블
    - 라우터는 내부에 저장하고 있는 라우팅 테이블이라는 정보를 활용하여 라우팅을 한다.
    - 테이블 안에는 목적지 호스트가 속한 네트워크 정보와 그 네트워크로 도달하기 위해 경유해야하는 라우터의 정보가 들어있다.

- 정적 라우팅과 동적 라우팅
    - 정적 라우팅 : 네트워크 관리자가 직접 수작업으로 라우팅 테이블을 설정하는 방식
    - 동적 라우팅 : 라우팅 프로토콜을 사용하여 자동적으로 경로 정보를 수집한 후 라우팅 테이블을 설정하는 방식

- 라우팅 테이블에 목적지 정보가 없을 경우
    - 한 라우터의 라우팅 테이블에 목적지의 정보가 없다면 해당 라우터보다 더 많은 정보를 가지고 있는 기본 라우터 혹은 디폴트 라우터에게 물어보게 된다.

- 동적 라우팅 알고리즘
    - 경로를 찾는 방식에 따라 크게 거리 벡터형과 링크 상태형의 두 가지가 많이 사용된다.
    - 이들 위에 자율 시스템 AS 간의 통신에서 사용되는 경로 벡터형도 있다.

- 경로 벡터형
    - RIP(routing information protocol)
    - 목적지까지의 거리를 살펴보고 짧은 경로를 선택하는 방식
    - 이때 거리는 경유하는 라우터의 수를 의미하는 홉의 수로 센다.
    - 이 방식은 비교적 구성이 간단한 LAN 네트워크에 적합하다.

- 링크 상태형
    - OSPF(open shortest path first)
    - 네트워크의 통신 상태 정보를 맵으로 관리하면서 상태가 가장 좋은 결로를 선택하는 방식
    - 복잡하고 변화가 잦은 네트워크 구성에 적합

## 6. 네트워크 오류를 통보하는 ICMP

: 데이터 전송 중에 오류가 발생하면 ICMP 프로토콜로 통보한다.

| 타입 | 의미 |
| --- | --- |
| 0 | 에코 응답. 수신측 장비가 존재한다고 확인해 줄 때 사용 |
| 3 | 데이터가 도착하지 않음 |
| 4 | 회선 상태가 혼잡 |
| 5 | 경로 상태가 최적이 아니다. |
| 8 | 에코 요청
수신 측 장비가 존재하는 지 확인할 때 사용 |
| 9 | 라우터가 보내는 응답으로, 네트워크에 새로 연결된 장비에게 사용 가능한 라우터 정보를 알려주기 위해 사용 |
| 10 | 장비가 보내는 요청으로, 네트워크에 새로 연결되었을 때 라우터를 찾기 위해 사용 |
| 11 | 생존 기간이 지난 패킷을 삭제했음을 알림 |

## 7. 어드레스 변환

: 프라이빗 IP 어드레스를 할당받은 호스트와 퍼블릭 IP 어드레스를 할당받은 호스트는 기본적으로 서로 통신을 하지 못한다. 하지만 어드레스 변환 기술을 사용하면 둘 간의 통신이 가능해진다.

- 네트워크 어드레스 변환(NAT) 동작 방식
    - Network Address Translation
    - 송신할 때는 송신지의 프라이빗 IP 어드레스를 라우터의 퍼블릭 IP 어드레스로 바꿔서 데이터를 보낸다.
    - 수신할 때는 라우터의 퍼블릭 IP 어드레스를 송신지의 프라이빗 IP 어드레스로 다시 바꿔 보낸다.

- NAT 제약사항
    - 내부의 여러 호스트가 공교롭게 같은 포트 번호를 사용하고 있다면 라우터는 이 요청에 대한 응답을 어느 호스트에게 되돌려 보내야 하는지 포트만 보고는 판단하지 못한다.
    - 내부에서 보낸 요청에 대한 응답은 받을 수 있지만 외부에서 일방적으로 보낸 데이터는 NAT 범위 안에 있는 호스트로 전달되지 않는다.

- 네트워크 어드레스 포트 변환 (NAPT)
    - NAT 의 포트 번호 충돌을 막기 위해 네트워크 어드레스 포트변환(Network Address Port Translation) 방식이 만들어졌다.
    - IP 어드레스 뿐만 아니라 포트번호도 함께 변환 한다.

## 8. 도메인명

: IP 어드레스는 긴 숫자 형태로 표현되기 때문에 사람이 알아보기 어렵다. 그래서 상대적으로 사람이 다루기 쉬운 도메인명을 대신 사용할 수 있다.

## 9. IP 어드레스를 자동으로 할당하는 DHCP

: DHCP 는 네트워크에 속한 호스트들에게 IP 어드레스를 자동으로 부여해 사람이 직접 IP를 설정하고 관리하는 수고를 덜어준다.

## 10. ipconfig 명령과 ping 명령

: ipconfig는 사용 중인 컴퓨터의 IP 어드레스를 확인할 때 사용하고, ping은 통신하려는 상대가 접속 가능한 상태인지 확인할 때 사용한다.

## 11. tracert 명령으로 통신 경로 확인하기

: tracert 는 목적지 컴퓨터까지 통신하면서 통과한 경로를 표시하는 명령

## 12. nslookup 명령으로 IP 어드레스 알아내기

: nslookup 명령은 DNS 서버에게 도메인명을 주고 IP 어드레스를 물어보거나 거꾸로 IP 어드레스를 주고 도메인명을 물어볼 때 사용한다.